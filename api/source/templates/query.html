{% extends "base.html" %}

{% block content %}
    <script type='text/javascript'>
      $(document).ready(function() {
        var max_fields = 11; //number of columns in database
        var wrapper = $("#formParamContainer");
        var add_button = $("#addParam");
        var x = 1; 

        $(add_button).click(function(e) {
          var fieldHTML = '<div><br><div class="form-group"><a class="btn btn-default pull-right" href="#" id="remove">Remove</a><label class="control-label col-sm-2" for="params['+ x +'][column]">Choose a column:</label><div><select name="params['+ x +'][column]"><option value="week_id">Week ID</option><option value="week">Week</option><option value="price">Price</option><option value="volume">Volume</option><option value="total_4046">Total 4046</option><option value="total_4225">Total 4225</option><option value="total_4770">Total 4770</option><option value="category">Category</option><option value="year">Year</option><option value="region">Region</option></select></div></div><div class="form-group"><label class="control-label col-sm-2" for="params['+ x +'][type]">Choose a type:</label><div><select name="params['+ x +'][type]"><option value="equals">Equal to</option><option value="greater_than">Greater than</option><option value="greater_equal">Greater than or equal to</option><option value="less_than">Less than</option><option value="less_equal">Less than or equal to</option></select></div></div><div class="form-group"><label class="control-label col-sm-2" for="params['+ x +'][value]">Value:</label><div class="col-sm-10"><input type="text" class="form-control" name="params['+ x +'][value]"></div></div></div>';
          e.preventDefault();
          if (x < max_fields) {
              x++;
              $(wrapper).append(fieldHTML); //add input boxes
          } else {
              alert('You Reached the limits')
          }
        });

        $(wrapper).on("click", "#remove", function(e) {
            e.preventDefault();
            $(this).parent('div').parent('div').remove();
            x--;
        })
      });
    </script> 
    <div class="container">
      <h2>Query Form</h2>
      <br>
      <p>Select as many columns as desired to be returned by the query. For the parameters, select a column from the database, a type operator, and the value of that column you are looking for. All entries fitting that criteria will be returned from the postgres database. Adding multiple parameters will only grab entries that meet all the criteria entered.</p>
      <br>
      <br>
      <h4>Columns to Return</h4>
      <br> 
      <form class="form-horizontal" enctype="application/json" action="https://isp-proxy.tacc.utexas.edu/phart/jobs" method="post">
        <div id="formColContainer">
          <input type="checkbox" name="cols" value="week_id"><label>Week ID</label><br>
          <input type="checkbox" name="cols" value="week"><label>Week</label><br>
          <input type="checkbox" name="cols" value="price"/><label>Price</label><br>
          <input type="checkbox" name="cols" value="volume"><label>Volume</label><br>
          <input type="checkbox" name="cols" value="total_4046"><label>Total 4046</label><br>
          <input type="checkbox" name="cols" value="total_4225"><label>Total 4225</label><br>
          <input type="checkbox" name="cols" value="total_4770"><label>Total 4770</label><br>
          <input type="checkbox" name="cols" value="category"><label>Category</label><br>
          <input type="checkbox" name="cols" value="year"><label>Year</label><br>
          <input type="checkbox" name="cols" value="region"><label>Region</label><br>
        </div>
        <br>
        <br>
        <div id="formParamContainer">
          <input type="hidden" id="job_type" name="job_type" value="query">
          <a class="btn btn-default" href="#" id="addParam">Add Parameter</a>
          <br>
          <br>
          <div>
            <div class="form-group">
              <label class="control-label col-sm-2" for="params[0][column]">Choose a column:</label>
              <div>
                <select name="params[0][column]">
                  <option value="week_id">Week ID</option>
                  <option value="week">Week</option>
                  <option value="price">Price</option>
                  <option value="volume">Volume</option>
                  <option value="total_4046">Total 4046</option>
                  <option value="total_4225">Total 4225</option>
                  <option value="total_4770">Total 4770</option>
                  <option value="category">Category</option>
                  <option value="year">Year</option>
                  <option value="region">Region</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="control-label col-sm-2" for="params[0][type]">Choose a type:</label>
              <div>
                <select name="params[0][type]">
                  <option value="equals">Equal to</option>
                  <option value="greater_than">Greater than</option>
                  <option value="greater_equal">Greater than or equal to</option>
                  <option value="less_than">Less than</option>
                  <option value="less_equal">Less than or equal to</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="control-label col-sm-2" for="params[0][value]">Value:</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" name="params[0][value]">
              </div>
            </div>
          </div> 
        </div>
        <div class="form-group">        
          <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-default">Submit</button>
          </div>
        </div>
      </form>
    </div>    
{% endblock %}
